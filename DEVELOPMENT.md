# 📰 Newsletter Maker - 開発ログ

## プロジェクト概要

高齢者福祉施設向けの新聞自動作成ツール。写真とテーマを選択するだけで、A4カラー新聞を自動生成できる。

## 要件定義

### 基本要件
- **写真**: 最大20枚（縦横バラバラ対応）
- **構成**: 写真50% + フリー素材・背景・テキスト50%
- **テキスト**: タイトル、行事名、簡単な説明（AI自動生成）
- **テンプレート**: 12種類（1月〜12月の行事対応）
- **デザイン**: カラフル
- **出力**: A4カラー印刷 + PDF保存

### 配布対象
- 施設のスタッフさん向け
- ITリテラシーが高くない可能性あり
- 簡単・直感的な操作が必須

## 技術スタック

### アプリ形態
- **最終形態**: Electronアプリ（デスクトップアプリ）
- **現在**: HTML/CSS/JavaScript（ブラウザで動作）
- **理由**: 完全無料、オフライン動作、配布が簡単

### 使用技術
```
- HTML5
- CSS3（グラデーション、Flexbox、Grid）
- Vanilla JavaScript (ES6+)
- jsPDF（PDF生成）
- html2canvas（HTML→Canvas変換）
```

### API依存
- **なし**（完全オフライン動作）
- コメント自動生成はパターンベース（APIキー不要）

## ファイル構成

```
newsletter-maker/
├── index.html           # メイン画面
├── css/
│   └── style.css       # スタイル定義
├── js/
│   ├── app.js          # メインロジック
│   ├── templates.js    # 12ヶ月テンプレート定義
│   └── generator.js    # 文章自動生成
├── assets/             # フリー素材置き場（将来用）
├── README.md           # プロジェクト説明
├── DEVELOPMENT.md      # この引き継ぎファイル
└── .gitignore
```

## 実装済み機能

### ✅ コア機能
- [x] 月選択（1〜12月）
- [x] 写真アップロード（ドラッグ&ドロップ対応）
- [x] 写真削除機能
- [x] タイトル・日付入力
- [x] コメント自動生成（パターンベース）
- [x] コメント手動編集
- [x] プレビュー表示（レスポンシブスケーリング）
- [x] 印刷機能
- [x] PDF保存機能

### ✅ レイアウト
- [x] 12ヶ月分のカラフルテンプレート
- [x] 5列×4行の写真グリッド（20枚対応）
- [x] A4サイズ（210mm × 297mm）に最適化
- [x] 画面サイズに応じた自動スケーリング

## 解決した問題

### 1. プレビュー表示の見切れ問題
**問題**: A4サイズが画面に収まらず、下部が見切れる

**解決策**:
- `.preview-wrapper` にレスポンシブスケーリングを実装
- 画面幅に応じて0.4〜1.0倍に自動調整
- 印刷時はスケーリングを無効化

### 2. 写真表示枚数の制限
**問題**: 最初は12枚までしか表示されていなかった

**解決策**:
- グリッドレイアウトを3列→5列に変更
- 表示枚数を12枚→20枚に拡張
- A4サイズに収まるようにサイズ調整

### 3. コメントのはみ出し問題
**問題**: コメントがA4の枠外にはみ出す

**解決策**:
- Flexboxレイアウトで要素配置を最適化
- コメント欄に `max-height: 45mm` を設定
- 各セクションのパディング・マージンを調整

### 4. 写真の縦横比が崩れる問題
**問題**: 写真が潰れて表示される

**解決策**:
- `position: absolute` で画像を配置
- `object-fit: cover` + `object-position: center` で縦横比保持
- 正方形グリッド内で中央を基準にトリミング

### 5. PDF出力時の縮小問題
**問題**: PDFが縮小されて出力される

**解決策**:
- PDF生成前に `.preview-wrapper` のスケーリングを一時解除
- 原寸サイズでPDF化
- 生成後は元のスケールに自動復帰

## 主要なコードパターン

### 月別テンプレート（templates.js）
```javascript
const MONTH_TEMPLATES = {
    1: {
        name: '新年会',
        colors: { primary: '#DC143C', secondary: '#FFD700', ... },
        decorations: ['🎍', '🎌', ...],
        commentTemplates: [...]
    },
    // 2〜12月も同様
};
```

### コメント自動生成（generator.js）
```javascript
class CommentGenerator {
    generateComment(eventName, eventDate) {
        // テンプレートからランダムに選択
        // プレースホルダー置換（{year}など）
        // デコレーション追加
    }
}
```

### PDF生成（app.js）
```javascript
async savePDF() {
    // スケーリング一時解除
    wrapper.style.transform = 'scale(1)';

    // html2canvasでキャンバス化
    const canvas = await html2canvas(wrapper, {scale: 2});

    // jsPDFで出力
    pdf.addImage(imgData, 'PNG', 0, 0, 210, 297);

    // スケール復帰
    wrapper.style.transform = originalTransform;
}
```

## 使い方

### 1. 起動方法
```bash
# ブラウザで開く
C:\Users\melof\newsletter-maker\index.html
```

### 2. 操作手順
1. 月を選択（1〜12月）
2. 写真をアップロード（ドラッグ&ドロップ or ボタン）
3. タイトル・日付を入力
4. 「コメント自動生成」ボタンをクリック
5. コメントを編集（必要に応じて）
6. 「プレビュー表示」で確認
7. 「印刷」または「PDF保存」

## 今後の拡張案

### 優先度: 高
- [ ] Electronアプリ化（インストーラー配布）
- [ ] フリー素材の自動挿入機能
- [ ] テンプレートカスタマイズ機能

### 優先度: 中
- [ ] 複数ページ対応（写真30枚以上の場合）
- [ ] レイアウトパターンの追加（2〜3種類）
- [ ] 施設ロゴのアップロード機能

### 優先度: 低
- [ ] AI API連携（Claude/OpenAI）でコメント生成
- [ ] クラウド保存機能
- [ ] テンプレート共有機能

## GitHubリポジトリ

https://github.com/melofla8os-ai/newsletter-maker

## 備考

- 完全無料で動作（APIキー不要）
- オフラインで使用可能
- ブラウザのみで動作（Chromeを推奨）
- PDF生成には外部CDN（jsPDF、html2canvas）を使用

---

**開発期間**: 2026-02-15
**ステータス**: プロトタイプ完成、動作確認済み
**次のステップ**: Electronアプリ化の検討
